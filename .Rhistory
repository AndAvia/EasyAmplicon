local({r = getOption("repos")
r["CRAN"] = "http://mirrors.tuna.tsinghua.edu.cn/CRAN/"
r["BioC_mirror"] = "https://mirrors.tuna.tsinghua.edu.cn/bioconductor"
options(repos=r)})
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
a = rownames(installed.packages())
install_package = c("devtools","Rcpp", "RcppArmadillo", "vegan", "dplyr", "reshape2", "gridExtra", "ggplot2", "ggthemes")
for (i in install_package) {
if (!i %in% a)
BiocManager::install(i, update = F)
}
if (!"FEAST" %in% a){
devtools::install_github("cozygene/FEAST")
}
suppressWarnings(suppressMessages(library("FEAST")))
##  读入样本信息表
metadata = Load_metadata(metadata_path = "FEAST_metadata.txt")
##  读入OTU丰度表
otus = Load_CountMatrix(CountMatrix_path = "FEAST_otu.txt")
##  设置结果输出路径
dir_path = getwd()
##  使用FEAST进行溯源
FEAST_output = suppressWarnings(suppressMessages(FEAST(C = otus, metadata = metadata, different_sources_flag = 1,
dir_path = dir_path,outfile="demo")))
(p = PlotSourceContribution(SinkNames = rownames(FEAST_output)[c(5:8)],
SourceNames = colnames(FEAST_output), dir_path = dir_path,
mixing_proportions = FEAST_output, Plot_title = "Test_",Same_sources_flag = 0, N = 4))
pdf("FEAST.pdf")   ##输出pdf格式的图片
PlotSourceContribution(SinkNames = rownames(FEAST_output)[c(5:8)],
SourceNames = colnames(FEAST_output), dir_path = dir_path,
mixing_proportions = FEAST_output, Plot_title = "Test_",Same_sources_flag = 0, N = 4)
dev.off()
